let stream=null,capturedImage=null;document.addEventListener('DOMContentLoaded',function(){setupUploadArea();setupPhotoInput()});function switchTab(n,b){document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-button').forEach(t=>t.classList.remove('active'));var x=document.getElementById(n+'-tab');if(x)x.classList.add('active');if(b)b.classList.add('active')}function startCamera(){var v=document.getElementById('video');navigator.mediaDevices.getUserMedia({video:{facingMode:'user',width:{ideal:640},height:{ideal:480}}}).then(function(m){stream=m;v.srcObject=m;document.getElementById('startCameraBtn').style.display='none';document.getElementById('captureBtn').style.display='inline-block';document.getElementById('stopCameraBtn').style.display='inline-block'}).catch(function(e){showMessage('Error: '+e.message,'error')})}function stopCamera(){if(stream){stream.getTracks().forEach(t=>t.stop());stream=null}document.getElementById('startCameraBtn').style.display='inline-block';document.getElementById('captureBtn').style.display='none';document.getElementById('stopCameraBtn').style.display='none'}function capturePhoto(){var v=document.getElementById('video'),c=document.getElementById('canvas'),x=c.getContext('2d');c.width=v.videoWidth;c.height=v.videoHeight;x.drawImage(v,0,0);c.toBlob(function(b){capturedImage=b;displayPreview(c.toDataURL('image/jpeg'));stopCamera()},'image/jpeg')}function setupUploadArea(){var u=document.getElementById('uploadArea'),p=document.getElementById('photoInput');if(u&&p)u.onclick=function(){p.click()}}function setupPhotoInput(){var p=document.getElementById('photoInput');if(p)p.onchange=function(e){if(e.target.files.length>0)handleFileUpload(e.target.files[0])}}function handleFileUpload(f){if(!f.type.startsWith('image/')){showMessage('Select image','error');return}var r=new FileReader();r.onload=function(e){capturedImage=f;displayPreview(e.target.result)};r.readAsDataURL(f)}function displayPreview(s){document.getElementById('preview').src=s;document.getElementById('previewSection').style.display='block'}function authenticateWithFace(){if(!capturedImage){showMessage('No image','error');return}var f=new FormData();f.append('image',capturedImage);fetch('/api/authenticate',{method:'POST',body:f}).then(r=>r.json()).then(d=>{if(d.success){showMessage('Success!','success');setTimeout(function(){window.location.href='/dashboard'},1500)}else{showMessage(d.message,'error')}}).catch(e=>showMessage('Error: '+e,'error'))}function resetLogin(){capturedImage=null;document.getElementById('previewSection').style.display='none';document.getElementById('photoInput').value=''}function showMessage(t,y){var m=document.getElementById('message');m.textContent=t;m.className='message '+y;m.style.display='block'}function showScanningAnimation(){var o=document.createElement('div');o.className='scanning-overlay';o.id='scanningOverlay';var s=document.createElement('div');s.className='scan-container';o.appendChild(s);document.body.appendChild(o)}function hideScanningAnimation(){var o=document.getElementById('scanningOverlay');if(o)o.remove()}